services:
- docker
- postgresql
sudo: required
before_install:
- openssl aes-256-cbc -K $encrypted_d303290e7d32_key -iv $encrypted_d303290e7d32_iv
  -in keys/id_rsa_observatory_extension.key.enc -out keys/id_rsa_observatory_extension.key
  -d
script: make $TEST_SUITE
addons:
  postgresql: '9.5'
install:
- sudo apt-get install -y postgresql-9.5-postgis-2.3
- sudo service postgresql restart
env:
- TEST_SUITE=travis-etl-metadatatest
- TEST_SUITE=travis-etl-unittest
- TEST_SUITE=travis-diff-catalog
deploy:
  provider: s3
  access_key_id: AKIAIZ65Y5OIY7ADFQ2Q
  secret_access_key:
    secure: YI5WmRplKG/D+kk3dFD1amIUnGlYVEVpr+OrveU75NSajfro9Dn5W9Q14vZvBU+S7QK8SsmlDqUKHthvqXItTJGy9gyRkigH1jKEY2EdeLHZHD/vezaNNpOWH16VdFxx0fIKRkboEdh+rkocRQDaRgTPCbnx7yw+9sHGA4XaG+P/rh0S+Fp5z2Y8NLp/KORoiaIFiYbgaTs97GJjGBj9L2dm6vK7okPNZlEbGGoxolQbekTNfr6Q5gYzyS7lV0ZapLFm5rEGnbzOwJTFXQXj2edmGKALC9zbE1AcIa/P28Qlqj3hcffFkCZ5RjadgZxKrHYiRNC+SkhlL/F+ujbmS8x49ADq5AGd/v7L/rglhuGcNAs6mTBoZ3y7BUzOefVDfTRCZt2VRNlU4OW5lstnCogJlVXoiWM2IFnQhQnwhFYCfR8hJAq4ibDEiYUCOp4TdRm6Mz2tCSQbMdoOP5aS9ncGVajegn7Z/XJAVM4OfJBzW9aLzOcRNZ071MzcNePaHUSjcrci6v8LlPIIB5Y83xI8sZQGlXdeJY4muZCoXegmjhvPPTxbDvwQs38GIIgMjc8+azEXtpONnow05xrssyBd3NCbSshKUErHmvd0vd4nhLlCVdJmOfpi/fxCODlEmoxKnkwdQ2pFMwArVVpZm/EyY8sNJ3OhAvbIQMZPJl4=
  bucket: data-observatory-catalog
  local-dir: catalog/build/html/
  upload-dir: catalogs/$TRAVIS_BRANCH
  acl: public_read
  skip_cleanup: true
  on:
    repo: CartoDB/bigmetadata
    all_branches: true
    condition: $TEST_SUITE = travis-diff-catalog
notifications:
  slack:
    secure: bVnmsbFhjevx+BCgGp29a54TSooTnUyJhyMhc/83UUVIso/nkTqzF1g8n+15sEymK4InMLFQu3p4kLLSf8fU1dTVngGk/ouyynwqHncQCuRPbHGikb+amS3JqP0qatR6j5YcED1ZhXno3FuJtMfwaVaY549NlQp3OpnZ4bZBBd8OuHKUbtTOEsuUONojoWtB85CmEw33sfxBJs7dyFJ5OswS8tu5WrQx55+TGB9S0MxmkgV60BvocgUWdFd3kmGd47G5YHCRa9kNw8sL1oDxdh21QJ3HgzbxL/NyR4sEpM5OBXT4XVrDeOnC9j1Y90YWpWPt0wGwN8mnm8H7RJx//B64TmogfrGWwjGCSmZR7jL4Gx3VYt9GtGUaZxv2S9GeCP78Dmgd+0nJ9mEJ0vZhMMibi1ZmIp5lmkVDbJbB6Cyco26TLeuPb2Gwm8r+ucL/ngUbU07obX2EkZR2r3hCT62FNig2U/+j7TUObfZcgKgPVqSSvBSFtbaNBfzT93ee/jTqmqui+nWdBDL2thmA0Agow9w6JhbSeVCujTUIyVNs0im1+8ynqzdUxLOeCbL5vEQsJdltgrYrGGo+q782ezK/HNm7/nIlGP22csWCOu2ydKhLYY+7zsu/u+6lzsS3mkjf7Mkz7zKk+tXY4oQcFGPaiZhh2gEfGtl61NYWiNU=
    template:
      - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository}@%{branch} by %{author} %{result} in %{duration}"
      - "Build catalog: https://s3.amazonaws.com/data-observatory-catalog/catalogs/%{branch}/index.html"
    on_success: always
